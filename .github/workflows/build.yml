name: macOS DMG Build and Release

on:
    push:
      branches:
        - master  # –ó–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É main

permissions:
  contents: write

jobs:
  build-macos:
    name: üéâ Build macOS DMG
    runs-on: macos-latest

    steps:
      - name: üîç Checkout –∫–æ–¥
        uses: actions/checkout@v4

      - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: stable
          architecture: x64

      - name: üì¶ –ü–æ–ª—É—á–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
        run: flutter pub get

      - name: üî® –°–æ–±—Ä–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ macOS (release)
        run: flutter build macos --release

      - name: üß∞ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å create-dmg
        run: brew install --cask create-dmg

      - name: üóÇ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É DMG
        run: |
          mkdir -p dmg_build
          cp -R build/macos/Build/Products/Release/*.app dmg_build/

      - name: üíæ –°–æ–∑–¥–∞—Ç—å DMG –æ–±—Ä–∞–∑
        run: |
          cd dmg_build
          create-dmg \
            --volname "MyFlutterApp" \
            --volume-icon "../macos/Runner/Assets.xcassets/AppIcon.appiconset/icon.icns" \
            --window-pos 200 120 \
            --window-size 800 600 \
            --icon-size 100 \
            --icon "MyFlutterApp.app" 200 190 \
            --hide-extension "MyFlutterApp.app" \
            --app-drop-link 600 185 \
            MyFlutterApp.dmg \
            MyFlutterApp.app

      - name: üåê –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∫–∞–∫ GitHub Release
        uses: svenstaro/upload-release-action@v2
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          file: dmg_build/MyFlutterApp.dmg
          tag: ${{ github.ref_name }} # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–≥ –∏–∑ git
          overwrite: true
          body: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±—Ä–∞–Ω–Ω–æ–µ macOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
          draft: false
          prerelease: false